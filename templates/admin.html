<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø§Ù„Ù…Ø¹Ù„Ù…</title>
  <style>
    body {
      background: #0f1826;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 2rem;
    }
    h2 { color: #ffd54f; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background: rgba(255,255,255,0.05);
    }
    th, td {
      padding: 0.8rem;
      border: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    th {
      background: #1e2b3a;
      color: #ffd54f;
    }
    tr:nth-child(even) {
      background-color: rgba(255,255,255,0.03);
    }
  </style>
</head>
<body>
  <h2>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… â€“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
  <input type="text" id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø£Ùˆ Ø¬Ù„Ø³Ø©..." style="margin-top: 1rem; padding: 0.5rem; width: 300px;">
  <div style="display:flex; gap:2rem; margin-bottom:1rem;">
  <div>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: <strong>{{ students|length }}</strong></div>
  <div>ğŸ“ˆ Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: <strong>{{ students[0].login_time.strftime('%Y/%m/%d â€“ %H:%M') }}</strong></div>
  <div>
    ğŸ¯ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†ØªÙŠØ¬Ø©:
    <strong>
      {{
        (students|map(attribute='score')|sum) // (students|length)
        if students|length > 0 else 0
      }} / 100
    </strong>
  </div>
</div>
    <input type="text" id="adminMsg" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø³Ø§Ù„Ø©â€¦" style="padding:0.5rem; width:300px;">
<button onclick="sendMsg()">ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·Ù„Ø§Ø¨</button>

    <button onclick="exportTableToExcel('studentsTable')" style="margin-bottom:1rem; padding:0.6rem;">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø±Ù‚Ù…</th>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ø¬Ù„Ø³Ø©</th>
        <th>Ø§Ù„ÙˆÙ‚Øª</th>
        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
        <th>Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ Ø²Ø§Ø±Ù‡Ø§</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
      <tr>
        <td>{{ student.id }}</td>
        <td>{{ student.name }}</td>
        <td>{{ student.session_code }}</td>
        <td>{{ student.login_time.strftime('%Y/%m/%d â€“ %H:%M') }}</td>
        <td>{{ student.score }} / 100</td>
        <td>
          {% if student.progress %}
            {{ student.progress.replace(',', ', ') }}
          {% else %}
            â€“
          {% endif %}
        </td>
        <td>
  <a href="/student/{{ student.id }}" target="_blank">ğŸ‘ï¸ Ø¹Ø±Ø¶</a>
</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <script>
  $(document).ready(function () {
    $("#searchBox").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("table tbody tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });
  function exportTableToExcel(tableID, filename = 'student_data.xls') {
    var dataType = 'application/vnd.ms-excel';
    var tableSelect = document.getElementById(tableID);
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

    var downloadLink = document.createElement("a");
    document.body.appendChild(downloadLink);
    downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    downloadLink.download = filename;
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }
</script>

<script>
  const socket = io();
  function sendMsg() {
    const msg = document.getElementById("adminMsg").value;
    socket.emit("admin_message", { message: msg });
  }
</script>

</body>
</html>
